var te=Object.defineProperty;var $=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var Q=(o,d,n)=>d in o?te(o,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[d]=n,q=(o,d)=>{for(var n in d||(d={}))X.call(d,n)&&Q(o,n,d[n]);if($)for(var n of $(d))Y.call(d,n)&&Q(o,n,d[n]);return o};var H=(o,d)=>{var n={};for(var x in o)X.call(o,x)&&d.indexOf(x)<0&&(n[x]=o[x]);if(o!=null&&$)for(var x of $(o))d.indexOf(x)<0&&Y.call(o,x)&&(n[x]=o[x]);return n};import{Fragment as oe,computed as g,defineComponent as j,h as Z,inject as le,nextTick as F,onMounted as J,onUnmounted as ne,provide as ae,ref as M,toRaw as C,watch as W,watchEffect as G}from"vue";import{Features as U,render as B,omit as z,compact as ie}from'../../utils/render.js';import{useId as K}from'../../hooks/use-id.js';import{Keys as V}from'../../keyboard.js';import{calculateActiveIndex as ue,Focus as I}from'../../utils/calculate-active-index.js';import{dom as y}from'../../utils/dom.js';import{useOpenClosed as re,State as _,useOpenClosedProvider as se}from'../../internal/open-closed.js';import{match as E}from'../../utils/match.js';import{useResolveButtonType as de}from'../../hooks/use-resolve-button-type.js';import{useTreeWalker as pe}from'../../hooks/use-tree-walker.js';import{sortByDomNode as fe}from'../../utils/focus-management.js';import{useOutsideClick as be}from'../../hooks/use-outside-click.js';import{Hidden as ve,Features as ce}from'../../internal/hidden.js';import{objectToFormEntries as me}from'../../utils/form.js';import{useControllable as xe}from'../../hooks/use-controllable.js';import{useTrackedPointer as Ce}from'../../hooks/use-tracked-pointer.js';import{isMobile as Se}from'../../utils/platform.js';function Oe(o,d){return o===d}var ge=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(ge||{}),Re=(n=>(n[n.Single=0]="Single",n[n.Multi=1]="Multi",n))(Re||{}),ye=(n=>(n[n.Pointer=0]="Pointer",n[n.Other=1]="Other",n))(ye||{});let ee=Symbol("ComboboxContext");function N(o){let d=le(ee,null);if(d===null){let n=new Error(`<${o} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,N),n}return d}let We=j({name:"Combobox",emits:{"update:modelValue":o=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],default:()=>Oe},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},name:{type:String},nullable:{type:Boolean,default:!1},multiple:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(o,{slots:d,attrs:n,emit:x}){let e=M(1),t=M(null),b=M(null),P=M(null),p=M(null),c=M({static:!1,hold:!1}),S=M([]),R=M(null),h=M(1),T=M(!1);function D(a=s=>s){let s=R.value!==null?S.value[R.value]:null,f=fe(a(S.value.slice()),m=>y(m.dataRef.domRef)),i=s?f.indexOf(s):null;return i===-1&&(i=null),{options:f,activeOptionIndex:i}}let l=g(()=>o.multiple?1:0),u=g(()=>o.nullable),[v,w]=xe(g(()=>o.modelValue===void 0?E(l.value,{[1]:[],[0]:void 0}):o.modelValue),a=>x("update:modelValue",a),g(()=>o.defaultValue)),r={comboboxState:e,value:v,mode:l,compare(a,s){if(typeof o.by=="string"){let f=o.by;return(a==null?void 0:a[f])===(s==null?void 0:s[f])}return o.by(a,s)},defaultValue:g(()=>o.defaultValue),nullable:u,inputRef:b,labelRef:t,buttonRef:P,optionsRef:p,disabled:g(()=>o.disabled),options:S,change(a){w(a)},activeOptionIndex:g(()=>{if(T.value&&R.value===null&&S.value.length>0){let a=S.value.findIndex(s=>!s.dataRef.disabled);if(a!==-1)return a}return R.value}),activationTrigger:h,optionsPropsRef:c,closeCombobox(){T.value=!1,!o.disabled&&e.value!==1&&(e.value=1,R.value=null)},openCombobox(){if(T.value=!0,o.disabled||e.value===0)return;let a=S.value.findIndex(s=>{let f=C(s.dataRef.value);return E(l.value,{[0]:()=>r.compare(C(r.value.value),C(f)),[1]:()=>C(r.value.value).some(m=>r.compare(C(m),C(f)))})});a!==-1&&(R.value=a),e.value=0},goToOption(a,s,f){if(T.value=!1,o.disabled||p.value&&!c.value.static&&e.value===1)return;let i=D();if(i.activeOptionIndex===null){let O=i.options.findIndex(A=>!A.dataRef.disabled);O!==-1&&(i.activeOptionIndex=O)}let m=ue(a===I.Specific?{focus:I.Specific,id:s}:{focus:a},{resolveItems:()=>i.options,resolveActiveIndex:()=>i.activeOptionIndex,resolveId:O=>O.id,resolveDisabled:O=>O.dataRef.disabled});R.value=m,h.value=f!=null?f:1,S.value=i.options},selectOption(a){let s=S.value.find(i=>i.id===a);if(!s)return;let{dataRef:f}=s;w(E(l.value,{[0]:()=>f.value,[1]:()=>{let i=C(r.value.value).slice(),m=C(f.value),O=i.findIndex(A=>r.compare(m,C(A)));return O===-1?i.push(m):i.splice(O,1),i}}))},selectActiveOption(){if(r.activeOptionIndex.value===null)return;let{dataRef:a,id:s}=S.value[r.activeOptionIndex.value];w(E(l.value,{[0]:()=>a.value,[1]:()=>{let f=C(r.value.value).slice(),i=C(a.value),m=f.findIndex(O=>r.compare(i,C(O)));return m===-1?f.push(i):f.splice(m,1),f}})),r.goToOption(I.Specific,s)},registerOption(a,s){let f={id:a,dataRef:s},i=D(m=>[...m,f]);if(R.value===null){let m=s.value.value;E(l.value,{[0]:()=>r.compare(C(r.value.value),C(m)),[1]:()=>C(r.value.value).some(A=>r.compare(C(A),C(m)))})&&(i.activeOptionIndex=i.options.indexOf(f))}S.value=i.options,R.value=i.activeOptionIndex,h.value=1},unregisterOption(a){var f;r.activeOptionIndex.value!==null&&((f=r.options.value[r.activeOptionIndex.value])==null?void 0:f.id)===a&&(T.value=!0);let s=D(i=>{let m=i.findIndex(O=>O.id===a);return m!==-1&&i.splice(m,1),i});S.value=s.options,R.value=s.activeOptionIndex,h.value=1}};be([b,P,p],()=>r.closeCombobox(),g(()=>e.value===0)),ae(ee,r),se(g(()=>E(e.value,{[0]:_.Open,[1]:_.Closed})));let L=g(()=>r.activeOptionIndex.value===null?null:S.value[r.activeOptionIndex.value].dataRef.value),k=g(()=>{var a;return(a=y(b))==null?void 0:a.closest("form")});return J(()=>{W([k],()=>{if(!k.value||o.defaultValue===void 0)return;function a(){r.change(o.defaultValue)}return k.value.addEventListener("reset",a),()=>{var s;(s=k.value)==null||s.removeEventListener("reset",a)}},{immediate:!0})}),()=>{let m=o,{name:a,disabled:s}=m,f=H(m,["name","disabled"]),i={open:e.value===0,disabled:s,activeIndex:r.activeOptionIndex.value,activeOption:L.value,value:v.value};return Z(oe,[...a!=null&&v.value!=null?me({[a]:v.value}).map(([O,A])=>Z(ve,ie({features:ce.Hidden,key:O,as:"input",type:"hidden",hidden:!0,readOnly:!0,name:O,value:A}))):[],B({theirProps:q(q({},n),z(f,["modelValue","defaultValue","nullable","multiple","onUpdate:modelValue","by"])),ourProps:{},slot:i,slots:d,attrs:n,name:"Combobox"})])}}}),Ge=j({name:"ComboboxLabel",props:{as:{type:[Object,String],default:"label"},id:{type:String,default:()=>`headlessui-combobox-label-${K()}`}},setup(o,{attrs:d,slots:n}){let x=N("ComboboxLabel");function e(){var t;(t=y(x.inputRef))==null||t.focus({preventScroll:!0})}return()=>{let t={open:x.comboboxState.value===0,disabled:x.disabled.value},c=o,{id:b}=c,P=H(c,["id"]),p={id:b,ref:x.labelRef,onClick:e};return B({ourProps:p,theirProps:P,slot:t,attrs:d,slots:n,name:"ComboboxLabel"})}}}),Qe=j({name:"ComboboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:()=>`headlessui-combobox-button-${K()}`}},setup(o,{attrs:d,slots:n,expose:x}){let e=N("ComboboxButton");x({el:e.buttonRef,$el:e.buttonRef});function t(p){e.disabled.value||(e.comboboxState.value===0?e.closeCombobox():(p.preventDefault(),e.openCombobox()),F(()=>{var c;return(c=y(e.inputRef))==null?void 0:c.focus({preventScroll:!0})}))}function b(p){switch(p.key){case V.ArrowDown:p.preventDefault(),p.stopPropagation(),e.comboboxState.value===1&&e.openCombobox(),F(()=>{var c;return(c=e.inputRef.value)==null?void 0:c.focus({preventScroll:!0})});return;case V.ArrowUp:p.preventDefault(),p.stopPropagation(),e.comboboxState.value===1&&(e.openCombobox(),F(()=>{e.value.value||e.goToOption(I.Last)})),F(()=>{var c;return(c=e.inputRef.value)==null?void 0:c.focus({preventScroll:!0})});return;case V.Escape:if(e.comboboxState.value!==0)return;p.preventDefault(),e.optionsRef.value&&!e.optionsPropsRef.value.static&&p.stopPropagation(),e.closeCombobox(),F(()=>{var c;return(c=e.inputRef.value)==null?void 0:c.focus({preventScroll:!0})});return}}let P=de(g(()=>({as:o.as,type:d.type})),e.buttonRef);return()=>{var T,D;let p={open:e.comboboxState.value===0,disabled:e.disabled.value,value:e.value.value},h=o,{id:c}=h,S=H(h,["id"]),R={ref:e.buttonRef,id:c,type:P.value,tabindex:"-1","aria-haspopup":"listbox","aria-controls":(T=y(e.optionsRef))==null?void 0:T.id,"aria-expanded":e.disabled.value?void 0:e.comboboxState.value===0,"aria-labelledby":e.labelRef.value?[(D=y(e.labelRef))==null?void 0:D.id,c].join(" "):void 0,disabled:e.disabled.value===!0?!0:void 0,onKeydown:b,onClick:t};return B({ourProps:R,theirProps:S,slot:p,attrs:d,slots:n,name:"ComboboxButton"})}}}),Xe=j({name:"ComboboxInput",props:{as:{type:[Object,String],default:"input"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},displayValue:{type:Function},defaultValue:{type:String,default:void 0},id:{type:String,default:()=>`headlessui-combobox-input-${K()}`}},emits:{change:o=>!0},setup(o,{emit:d,attrs:n,slots:x,expose:e}){let t=N("ComboboxInput"),b={value:!1};e({el:t.inputRef,$el:t.inputRef});let P=g(()=>{var u;let l=t.value.value;return y(t.inputRef)?typeof o.displayValue!="undefined"&&l!==void 0?(u=o.displayValue(l))!=null?u:"":typeof l=="string"?l:"":""});J(()=>{W([P,t.comboboxState],([l,u],[v,w])=>{if(b.value)return;let r=y(t.inputRef);r&&(w===0&&u===1||l!==v)&&(r.value=l)},{immediate:!0}),W([t.comboboxState],([l],[u])=>{if(l===0&&u===1){let v=y(t.inputRef);if(!v)return;let w=v.value,{selectionStart:r,selectionEnd:L,selectionDirection:k}=v;v.value="",v.value=w,k!==null?v.setSelectionRange(r,L,k):v.setSelectionRange(r,L)}})});let p=M(!1);function c(){p.value=!0}function S(){setTimeout(()=>{p.value=!1})}function R(l){switch(b.value=!0,l.key){case V.Backspace:case V.Delete:if(t.mode.value!==0||!t.nullable.value)return;let u=l.currentTarget;requestAnimationFrame(()=>{if(u.value===""){t.change(null);let v=y(t.optionsRef);v&&(v.scrollTop=0),t.goToOption(I.Nothing)}});break;case V.Enter:if(b.value=!1,t.comboboxState.value!==0||p.value)return;if(l.preventDefault(),l.stopPropagation(),t.activeOptionIndex.value===null){t.closeCombobox();return}t.selectActiveOption(),t.mode.value===0&&t.closeCombobox();break;case V.ArrowDown:return b.value=!1,l.preventDefault(),l.stopPropagation(),E(t.comboboxState.value,{[0]:()=>t.goToOption(I.Next),[1]:()=>t.openCombobox()});case V.ArrowUp:return b.value=!1,l.preventDefault(),l.stopPropagation(),E(t.comboboxState.value,{[0]:()=>t.goToOption(I.Previous),[1]:()=>{t.openCombobox(),F(()=>{t.value.value||t.goToOption(I.Last)})}});case V.Home:if(l.shiftKey)break;return b.value=!1,l.preventDefault(),l.stopPropagation(),t.goToOption(I.First);case V.PageUp:return b.value=!1,l.preventDefault(),l.stopPropagation(),t.goToOption(I.First);case V.End:if(l.shiftKey)break;return b.value=!1,l.preventDefault(),l.stopPropagation(),t.goToOption(I.Last);case V.PageDown:return b.value=!1,l.preventDefault(),l.stopPropagation(),t.goToOption(I.Last);case V.Escape:if(b.value=!1,t.comboboxState.value!==0)return;l.preventDefault(),t.optionsRef.value&&!t.optionsPropsRef.value.static&&l.stopPropagation(),t.closeCombobox();break;case V.Tab:if(b.value=!1,t.comboboxState.value!==0)return;t.mode.value===0&&t.selectActiveOption(),t.closeCombobox();break}}function h(l){t.openCombobox(),d("change",l)}function T(){b.value=!1}let D=g(()=>{var l,u,v,w;return(w=(v=(u=o.defaultValue)!=null?u:t.defaultValue.value!==void 0?(l=o.displayValue)==null?void 0:l.call(o,t.defaultValue.value):null)!=null?v:t.defaultValue.value)!=null?w:""});return()=>{var a,s,f,i,m,O;let l={open:t.comboboxState.value===0},k=o,{id:u,displayValue:v,onChange:w}=k,r=H(k,["id","displayValue","onChange"]),L={"aria-controls":(a=t.optionsRef.value)==null?void 0:a.id,"aria-expanded":t.disabled.value?void 0:t.comboboxState.value===0,"aria-activedescendant":t.activeOptionIndex.value===null||(s=t.options.value[t.activeOptionIndex.value])==null?void 0:s.id,"aria-labelledby":(m=(f=y(t.labelRef))==null?void 0:f.id)!=null?m:(i=y(t.buttonRef))==null?void 0:i.id,"aria-autocomplete":"list",id:u,onCompositionstart:c,onCompositionend:S,onKeydown:R,onInput:h,onBlur:T,role:"combobox",type:(O=n.type)!=null?O:"text",tabIndex:0,ref:t.inputRef,defaultValue:D.value};return B({ourProps:L,theirProps:r,slot:l,attrs:n,slots:x,features:U.RenderStrategy|U.Static,name:"ComboboxInput"})}}}),Ye=j({name:"ComboboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},hold:{type:[Boolean],default:!1}},setup(o,{attrs:d,slots:n,expose:x}){let e=N("ComboboxOptions"),t=`headlessui-combobox-options-${K()}`;x({el:e.optionsRef,$el:e.optionsRef}),G(()=>{e.optionsPropsRef.value.static=o.static}),G(()=>{e.optionsPropsRef.value.hold=o.hold});let b=re(),P=g(()=>b!==null?(b.value&_.Open)===_.Open:e.comboboxState.value===0);return pe({container:g(()=>y(e.optionsRef)),enabled:g(()=>e.comboboxState.value===0),accept(p){return p.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:p.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(p){p.setAttribute("role","none")}}),()=>{var R,h,T;let p={open:e.comboboxState.value===0},c={"aria-labelledby":(T=(R=y(e.labelRef))==null?void 0:R.id)!=null?T:(h=y(e.buttonRef))==null?void 0:h.id,id:t,ref:e.optionsRef,role:"listbox","aria-multiselectable":e.mode.value===1?!0:void 0},S=z(o,["hold"]);return B({ourProps:c,theirProps:S,slot:p,attrs:d,slots:n,features:U.RenderStrategy|U.Static,visible:P.value,name:"ComboboxOptions"})}}}),Ze=j({name:"ComboboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1}},setup(o,{slots:d,attrs:n,expose:x}){let e=N("ComboboxOption"),t=`headlessui-combobox-option-${K()}`,b=M(null);x({el:b,$el:b});let P=g(()=>e.activeOptionIndex.value!==null?e.options.value[e.activeOptionIndex.value].id===t:!1),p=g(()=>E(e.mode.value,{[0]:()=>e.compare(C(e.value.value),C(o.value)),[1]:()=>C(e.value.value).some(u=>e.compare(C(u),C(o.value)))})),c=g(()=>({disabled:o.disabled,value:o.value,domRef:b}));J(()=>e.registerOption(t,c)),ne(()=>e.unregisterOption(t)),G(()=>{e.comboboxState.value===0&&P.value&&e.activationTrigger.value!==0&&F(()=>{var u,v;return(v=(u=y(b))==null?void 0:u.scrollIntoView)==null?void 0:v.call(u,{block:"nearest"})})});function S(u){if(o.disabled)return u.preventDefault();e.selectOption(t),e.mode.value===0&&e.closeCombobox(),Se()||requestAnimationFrame(()=>{var v;return(v=y(e.inputRef))==null?void 0:v.focus()})}function R(){if(o.disabled)return e.goToOption(I.Nothing);e.goToOption(I.Specific,t)}let h=Ce();function T(u){h.update(u)}function D(u){h.wasMoved(u)&&(o.disabled||P.value||e.goToOption(I.Specific,t,0))}function l(u){h.wasMoved(u)&&(o.disabled||P.value&&(e.optionsPropsRef.value.hold||e.goToOption(I.Nothing)))}return()=>{let{disabled:u}=o,v={active:P.value,selected:p.value,disabled:u},w={id:t,ref:b,role:"option",tabIndex:u===!0?void 0:-1,"aria-disabled":u===!0?!0:void 0,"aria-selected":p.value,disabled:void 0,onClick:S,onFocus:R,onPointerenter:T,onMouseenter:T,onPointermove:D,onMousemove:D,onPointerleave:l,onMouseleave:l};return B({ourProps:w,theirProps:o,slot:v,attrs:n,slots:d,name:"ComboboxOption"})}}});export{We as Combobox,Qe as ComboboxButton,Xe as ComboboxInput,Ge as ComboboxLabel,Ze as ComboboxOption,Ye as ComboboxOptions};
