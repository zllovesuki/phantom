var x=Object.defineProperty;var H=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var k=(t,n,e)=>n in t?x(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,w=(t,n)=>{for(var e in n||(n={}))D.call(n,e)&&k(t,e,n[e]);if(H)for(var e of H(n))P.call(n,e)&&k(t,e,n[e]);return t};var B=(t,n)=>{var e={};for(var l in t)D.call(t,l)&&n.indexOf(l)<0&&(e[l]=t[l]);if(t!=null&&H)for(var l of H(t))n.indexOf(l)<0&&P.call(t,l)&&(e[l]=t[l]);return e};import{computed as F,defineComponent as U,h as y,onMounted as g,onUnmounted as S,ref as E,watch as N,Fragment as _}from"vue";import{render as q}from'../../utils/render.js';import{Hidden as A,Features as O}from'../../internal/hidden.js';import{dom as M}from'../../utils/dom.js';import{focusIn as b,Focus as T,focusElement as v,FocusResult as G}from'../../utils/focus-management.js';import{match as I}from'../../utils/match.js';import{useTabDirection as W,Direction as R}from'../../hooks/use-tab-direction.js';import{getOwnerDocument as $}from'../../utils/owner.js';import{useEventListener as z}from'../../hooks/use-event-listener.js';import{microTask as J}from'../../utils/micro-task.js';var j=(o=>(o[o.None=1]="None",o[o.InitialFocus=2]="InitialFocus",o[o.TabLock=4]="TabLock",o[o.FocusLock=8]="FocusLock",o[o.RestoreFocus=16]="RestoreFocus",o[o.All=30]="All",o))(j||{});let me=Object.assign(U({name:"FocusTrap",props:{as:{type:[Object,String],default:"div"},initialFocus:{type:Object,default:null},features:{type:Number,default:30},containers:{type:Object,default:E(new Set)}},inheritAttrs:!1,setup(t,{attrs:n,slots:e,expose:l}){let u=E(null);l({el:u,$el:u});let a=F(()=>$(u));Q({ownerDocument:a},F(()=>Boolean(t.features&16)));let o=X({ownerDocument:a,container:u,initialFocus:F(()=>t.initialFocus)},F(()=>Boolean(t.features&2)));Y({ownerDocument:a,container:u,containers:t.containers,previousActiveElement:o},F(()=>Boolean(t.features&8)));let s=W();function c(i){let m=M(u);if(!m)return;(p=>p())(()=>{I(s.value,{[R.Forwards]:()=>{b(m,T.First,{skipElements:[i.relatedTarget]})},[R.Backwards]:()=>{b(m,T.Last,{skipElements:[i.relatedTarget]})}})})}let r=E(!1);function f(i){i.key==="Tab"&&(r.value=!0,requestAnimationFrame(()=>{r.value=!1}))}function L(i){var p;let m=new Set((p=t.containers)==null?void 0:p.value);m.add(u);let d=i.relatedTarget;d instanceof HTMLElement&&d.dataset.headlessuiFocusGuard!=="true"&&(K(m,d)||(r.value?b(M(u),I(s.value,{[R.Forwards]:()=>T.Next,[R.Backwards]:()=>T.Previous})|T.WrapAround,{relativeTo:i.target}):i.target instanceof HTMLElement&&v(i.target)))}return()=>{let i={},m={ref:u,onKeydown:f,onFocusout:L},h=t,{features:d,initialFocus:p,containers:Z}=h,C=B(h,["features","initialFocus","containers"]);return y(_,[Boolean(d&4)&&y(A,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:c,features:O.Focusable}),q({ourProps:m,theirProps:w(w({},n),C),slot:i,attrs:n,slots:e,name:"FocusTrap"}),Boolean(d&4)&&y(A,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:c,features:O.Focusable})])}}}),{features:j});function Q({ownerDocument:t},n){let e=E(null);function l(){var a;e.value||(e.value=(a=t.value)==null?void 0:a.activeElement)}function u(){e.value&&(v(e.value),e.value=null)}g(()=>{N(n,(a,o)=>{a!==o&&(a?l():u())},{immediate:!0})}),S(u)}function X({ownerDocument:t,container:n,initialFocus:e},l){let u=E(null),a=E(!1);return g(()=>a.value=!0),S(()=>a.value=!1),g(()=>{N([n,e,l],(o,s)=>{if(o.every((r,f)=>(s==null?void 0:s[f])===r)||!l.value)return;let c=M(n);c&&J(()=>{var L,i;if(!a.value)return;let r=M(e),f=(L=t.value)==null?void 0:L.activeElement;if(r){if(r===f){u.value=f;return}}else if(c.contains(f)){u.value=f;return}r?v(r):b(c,T.First|T.NoScroll)===G.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),u.value=(i=t.value)==null?void 0:i.activeElement})},{immediate:!0,flush:"post"})}),u}function Y({ownerDocument:t,container:n,containers:e,previousActiveElement:l},u){var a;z((a=t.value)==null?void 0:a.defaultView,"focus",o=>{if(!u.value)return;let s=new Set(e==null?void 0:e.value);s.add(n);let c=l.value;if(!c)return;let r=o.target;r&&r instanceof HTMLElement?K(s,r)?(l.value=r,v(r)):(o.preventDefault(),o.stopPropagation(),v(c)):v(l.value)},!0)}function K(t,n){var e;for(let l of t)if((e=l.value)!=null&&e.contains(n))return!0;return!1}export{me as FocusTrap};
