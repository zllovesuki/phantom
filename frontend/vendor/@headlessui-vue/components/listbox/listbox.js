var J=Object.defineProperty;var F=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var U=(t,r,i)=>r in t?J(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,H=(t,r)=>{for(var i in r||(r={}))$.call(r,i)&&U(t,i,r[i]);if(F)for(var i of F(r))Q.call(r,i)&&U(t,i,r[i]);return t};var V=(t,r)=>{var i={};for(var d in t)$.call(t,d)&&r.indexOf(d)<0&&(i[d]=t[d]);if(t!=null&&F)for(var d of F(t))r.indexOf(d)<0&&Q.call(t,d)&&(i[d]=t[d]);return i};import{Fragment as X,computed as g,defineComponent as E,h as z,inject as Y,nextTick as C,onMounted as B,onUnmounted as Z,provide as ee,ref as P,toRaw as w,watch as _,watchEffect as te}from"vue";import{Features as q,render as j,omit as oe,compact as ie}from'../../utils/render.js';import{useId as K}from'../../hooks/use-id.js';import{Keys as b}from'../../keyboard.js';import{calculateActiveIndex as ae,Focus as y}from'../../utils/calculate-active-index.js';import{dom as m}from'../../utils/dom.js';import{useOpenClosed as ne,State as N,useOpenClosedProvider as le}from'../../internal/open-closed.js';import{match as M}from'../../utils/match.js';import{useResolveButtonType as ue}from'../../hooks/use-resolve-button-type.js';import{FocusableMode as re,isFocusableElement as se,sortByDomNode as de}from'../../utils/focus-management.js';import{useOutsideClick as fe}from'../../hooks/use-outside-click.js';import{Hidden as pe,Features as ce}from'../../internal/hidden.js';import{objectToFormEntries as ve}from'../../utils/form.js';import{useControllable as be}from'../../hooks/use-controllable.js';import{useTrackedPointer as me}from'../../hooks/use-tracked-pointer.js';function xe(t,r){return t===r}var Se=(i=>(i[i.Open=0]="Open",i[i.Closed=1]="Closed",i))(Se||{}),Oe=(i=>(i[i.Single=0]="Single",i[i.Multi=1]="Multi",i))(Oe||{}),ge=(i=>(i[i.Pointer=0]="Pointer",i[i.Other=1]="Other",i))(ge||{});function ye(t){requestAnimationFrame(()=>requestAnimationFrame(t))}let W=Symbol("ListboxContext");function A(t){let r=Y(W,null);if(r===null){let i=new Error(`<${t} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,A),i}return r}let $e=E({name:"Listbox",emits:{"update:modelValue":t=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],default:()=>xe},horizontal:{type:[Boolean],default:!1},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},name:{type:String,optional:!0},multiple:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:r,attrs:i,emit:d}){let e=P(1),c=P(null),x=P(null),S=P(null),v=P([]),o=P(""),a=P(null),D=P(1);function T(n=u=>u){let u=a.value!==null?v.value[a.value]:null,s=de(n(v.value.slice()),O=>m(O.dataRef.domRef)),p=u?s.indexOf(u):null;return p===-1&&(p=null),{options:s,activeOptionIndex:p}}let R=g(()=>t.multiple?1:0),[L,k]=be(g(()=>t.modelValue===void 0?M(R.value,{[1]:[],[0]:void 0}):t.modelValue),n=>d("update:modelValue",n),g(()=>t.defaultValue)),l={listboxState:e,value:L,mode:R,compare(n,u){if(typeof t.by=="string"){let s=t.by;return(n==null?void 0:n[s])===(u==null?void 0:u[s])}return t.by(n,u)},orientation:g(()=>t.horizontal?"horizontal":"vertical"),labelRef:c,buttonRef:x,optionsRef:S,disabled:g(()=>t.disabled),options:v,searchQuery:o,activeOptionIndex:a,activationTrigger:D,closeListbox(){t.disabled||e.value!==1&&(e.value=1,a.value=null)},openListbox(){t.disabled||e.value!==0&&(e.value=0)},goToOption(n,u,s){if(t.disabled||e.value===1)return;let p=T(),O=ae(n===y.Specific?{focus:y.Specific,id:u}:{focus:n},{resolveItems:()=>p.options,resolveActiveIndex:()=>p.activeOptionIndex,resolveId:h=>h.id,resolveDisabled:h=>h.dataRef.disabled});o.value="",a.value=O,D.value=s!=null?s:1,v.value=p.options},search(n){if(t.disabled||e.value===1)return;let s=o.value!==""?0:1;o.value+=n.toLowerCase();let O=(a.value!==null?v.value.slice(a.value+s).concat(v.value.slice(0,a.value+s)):v.value).find(I=>I.dataRef.textValue.startsWith(o.value)&&!I.dataRef.disabled),h=O?v.value.indexOf(O):-1;h===-1||h===a.value||(a.value=h,D.value=1)},clearSearch(){t.disabled||e.value!==1&&o.value!==""&&(o.value="")},registerOption(n,u){let s=T(p=>[...p,{id:n,dataRef:u}]);v.value=s.options,a.value=s.activeOptionIndex},unregisterOption(n){let u=T(s=>{let p=s.findIndex(O=>O.id===n);return p!==-1&&s.splice(p,1),s});v.value=u.options,a.value=u.activeOptionIndex,D.value=1},select(n){t.disabled||k(M(R.value,{[0]:()=>n,[1]:()=>{let u=w(l.value.value).slice(),s=w(n),p=u.findIndex(O=>l.compare(s,w(O)));return p===-1?u.push(s):u.splice(p,1),u}}))}};fe([x,S],(n,u)=>{var s;l.closeListbox(),se(u,re.Loose)||(n.preventDefault(),(s=m(x))==null||s.focus())},g(()=>e.value===0)),ee(W,l),le(g(()=>M(e.value,{[0]:N.Open,[1]:N.Closed})));let f=g(()=>{var n;return(n=m(x))==null?void 0:n.closest("form")});return B(()=>{_([f],()=>{if(!f.value||t.defaultValue===void 0)return;function n(){l.select(t.defaultValue)}return f.value.addEventListener("reset",n),()=>{var u;(u=f.value)==null||u.removeEventListener("reset",n)}},{immediate:!0})}),()=>{let h=t,{name:n,modelValue:u,disabled:s}=h,p=V(h,["name","modelValue","disabled"]),O={open:e.value===0,disabled:s,value:L.value};return z(X,[...n!=null&&L.value!=null?ve({[n]:L.value}).map(([I,G])=>z(pe,ie({features:ce.Hidden,key:I,as:"input",type:"hidden",hidden:!0,readOnly:!0,name:I,value:G}))):[],j({ourProps:{},theirProps:H(H({},i),oe(p,["defaultValue","onUpdate:modelValue","horizontal","multiple","by"])),slot:O,slots:r,attrs:i,name:"Listbox"})])}}}),Qe=E({name:"ListboxLabel",props:{as:{type:[Object,String],default:"label"},id:{type:String,default:()=>`headlessui-listbox-label-${K()}`}},setup(t,{attrs:r,slots:i}){let d=A("ListboxLabel");function e(){var c;(c=m(d.buttonRef))==null||c.focus({preventScroll:!0})}return()=>{let c={open:d.listboxState.value===0,disabled:d.disabled.value},o=t,{id:x}=o,S=V(o,["id"]),v={id:x,ref:d.labelRef,onClick:e};return j({ourProps:v,theirProps:S,slot:c,attrs:r,slots:i,name:"ListboxLabel"})}}}),ze=E({name:"ListboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:()=>`headlessui-listbox-button-${K()}`}},setup(t,{attrs:r,slots:i,expose:d}){let e=A("ListboxButton");d({el:e.buttonRef,$el:e.buttonRef});function c(o){switch(o.key){case b.Space:case b.Enter:case b.ArrowDown:o.preventDefault(),e.openListbox(),C(()=>{var a;(a=m(e.optionsRef))==null||a.focus({preventScroll:!0}),e.value.value||e.goToOption(y.First)});break;case b.ArrowUp:o.preventDefault(),e.openListbox(),C(()=>{var a;(a=m(e.optionsRef))==null||a.focus({preventScroll:!0}),e.value.value||e.goToOption(y.Last)});break}}function x(o){switch(o.key){case b.Space:o.preventDefault();break}}function S(o){e.disabled.value||(e.listboxState.value===0?(e.closeListbox(),C(()=>{var a;return(a=m(e.buttonRef))==null?void 0:a.focus({preventScroll:!0})})):(o.preventDefault(),e.openListbox(),ye(()=>{var a;return(a=m(e.optionsRef))==null?void 0:a.focus({preventScroll:!0})})))}let v=ue(g(()=>({as:t.as,type:r.type})),e.buttonRef);return()=>{var L,k;let o={open:e.listboxState.value===0,disabled:e.disabled.value,value:e.value.value},R=t,{id:a}=R,D=V(R,["id"]),T={ref:e.buttonRef,id:a,type:v.value,"aria-haspopup":"listbox","aria-controls":(L=m(e.optionsRef))==null?void 0:L.id,"aria-expanded":e.disabled.value?void 0:e.listboxState.value===0,"aria-labelledby":e.labelRef.value?[(k=m(e.labelRef))==null?void 0:k.id,a].join(" "):void 0,disabled:e.disabled.value===!0?!0:void 0,onKeydown:c,onKeyup:x,onClick:S};return j({ourProps:T,theirProps:D,slot:o,attrs:r,slots:i,name:"ListboxButton"})}}}),_e=E({name:"ListboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-listbox-options-${K()}`}},setup(t,{attrs:r,slots:i,expose:d}){let e=A("ListboxOptions"),c=P(null);d({el:e.optionsRef,$el:e.optionsRef});function x(o){switch(c.value&&clearTimeout(c.value),o.key){case b.Space:if(e.searchQuery.value!=="")return o.preventDefault(),o.stopPropagation(),e.search(o.key);case b.Enter:if(o.preventDefault(),o.stopPropagation(),e.activeOptionIndex.value!==null){let a=e.options.value[e.activeOptionIndex.value];e.select(a.dataRef.value)}e.mode.value===0&&(e.closeListbox(),C(()=>{var a;return(a=m(e.buttonRef))==null?void 0:a.focus({preventScroll:!0})}));break;case M(e.orientation.value,{vertical:b.ArrowDown,horizontal:b.ArrowRight}):return o.preventDefault(),o.stopPropagation(),e.goToOption(y.Next);case M(e.orientation.value,{vertical:b.ArrowUp,horizontal:b.ArrowLeft}):return o.preventDefault(),o.stopPropagation(),e.goToOption(y.Previous);case b.Home:case b.PageUp:return o.preventDefault(),o.stopPropagation(),e.goToOption(y.First);case b.End:case b.PageDown:return o.preventDefault(),o.stopPropagation(),e.goToOption(y.Last);case b.Escape:o.preventDefault(),o.stopPropagation(),e.closeListbox(),C(()=>{var a;return(a=m(e.buttonRef))==null?void 0:a.focus({preventScroll:!0})});break;case b.Tab:o.preventDefault(),o.stopPropagation();break;default:o.key.length===1&&(e.search(o.key),c.value=setTimeout(()=>e.clearSearch(),350));break}}let S=ne(),v=g(()=>S!==null?(S.value&N.Open)===N.Open:e.listboxState.value===0);return()=>{var L,k,l,f;let o={open:e.listboxState.value===0},R=t,{id:a}=R,D=V(R,["id"]),T={"aria-activedescendant":e.activeOptionIndex.value===null||(L=e.options.value[e.activeOptionIndex.value])==null?void 0:L.id,"aria-multiselectable":e.mode.value===1?!0:void 0,"aria-labelledby":(f=(k=m(e.labelRef))==null?void 0:k.id)!=null?f:(l=m(e.buttonRef))==null?void 0:l.id,"aria-orientation":e.orientation.value,id:a,onKeydown:x,role:"listbox",tabIndex:0,ref:e.optionsRef};return j({ourProps:T,theirProps:D,slot:o,attrs:r,slots:i,features:q.RenderStrategy|q.Static,visible:v.value,name:"ListboxOptions"})}}}),qe=E({name:"ListboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-listbox.option-${K()}`}},setup(t,{slots:r,attrs:i,expose:d}){let e=A("ListboxOption"),c=P(null);d({el:c,$el:c});let x=g(()=>e.activeOptionIndex.value!==null?e.options.value[e.activeOptionIndex.value].id===t.id:!1),S=g(()=>M(e.mode.value,{[0]:()=>e.compare(w(e.value.value),w(t.value)),[1]:()=>w(e.value.value).some(l=>e.compare(w(l),w(t.value)))})),v=g(()=>M(e.mode.value,{[1]:()=>{var f;let l=w(e.value.value);return((f=e.options.value.find(n=>l.some(u=>e.compare(w(u),w(n.dataRef.value)))))==null?void 0:f.id)===t.id},[0]:()=>S.value})),o=g(()=>({disabled:t.disabled,value:t.value,textValue:"",domRef:c}));B(()=>{var f,n;let l=(n=(f=m(c))==null?void 0:f.textContent)==null?void 0:n.toLowerCase().trim();l!==void 0&&(o.value.textValue=l)}),B(()=>e.registerOption(t.id,o)),Z(()=>e.unregisterOption(t.id)),B(()=>{_([e.listboxState,S],()=>{e.listboxState.value===0&&S.value&&M(e.mode.value,{[1]:()=>{v.value&&e.goToOption(y.Specific,t.id)},[0]:()=>{e.goToOption(y.Specific,t.id)}})},{immediate:!0})}),te(()=>{e.listboxState.value===0&&x.value&&e.activationTrigger.value!==0&&C(()=>{var l,f;return(f=(l=m(c))==null?void 0:l.scrollIntoView)==null?void 0:f.call(l,{block:"nearest"})})});function a(l){if(t.disabled)return l.preventDefault();e.select(t.value),e.mode.value===0&&(e.closeListbox(),C(()=>{var f;return(f=m(e.buttonRef))==null?void 0:f.focus({preventScroll:!0})}))}function D(){if(t.disabled)return e.goToOption(y.Nothing);e.goToOption(y.Specific,t.id)}let T=me();function R(l){T.update(l)}function L(l){T.wasMoved(l)&&(t.disabled||x.value||e.goToOption(y.Specific,t.id,0))}function k(l){T.wasMoved(l)&&(t.disabled||x.value&&e.goToOption(y.Nothing))}return()=>{let{disabled:l}=t,f={active:x.value,selected:S.value,disabled:l},h=t,{id:n,value:u,disabled:s}=h,p=V(h,["id","value","disabled"]),O={id:n,ref:c,role:"option",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,"aria-selected":S.value,disabled:void 0,onClick:a,onFocus:D,onPointerenter:R,onMouseenter:R,onPointermove:L,onMousemove:L,onPointerleave:k,onMouseleave:k};return j({ourProps:O,theirProps:p,slot:f,attrs:i,slots:r,name:"ListboxOption"})}}});export{$e as Listbox,ze as ListboxButton,Qe as ListboxLabel,qe as ListboxOption,_e as ListboxOptions};
