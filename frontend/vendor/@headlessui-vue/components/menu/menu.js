var V=Object.defineProperty;var x=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var A=(a,r,u)=>r in a?V(a,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):a[r]=u,k=(a,r)=>{for(var u in r||(r={}))K.call(r,u)&&A(a,u,r[u]);if(x)for(var u of x(r))L.call(r,u)&&A(a,u,r[u]);return a};var T=(a,r)=>{var u={};for(var s in a)K.call(a,s)&&r.indexOf(s)<0&&(u[s]=a[s]);if(a!=null&&x)for(var s of x(a))r.indexOf(s)<0&&L.call(a,s)&&(u[s]=a[s]);return u};import{defineComponent as D,ref as R,provide as H,inject as Q,onMounted as N,onUnmounted as _,computed as h,nextTick as y,watchEffect as q}from"vue";import{Features as j,render as P}from'../../utils/render.js';import{useId as C}from'../../hooks/use-id.js';import{Keys as p}from'../../keyboard.js';import{Focus as b,calculateActiveIndex as W}from'../../utils/calculate-active-index.js';import{dom as v}from'../../utils/dom.js';import{useTreeWalker as J}from'../../hooks/use-tree-walker.js';import{useOpenClosedProvider as z,State as O,useOpenClosed as G}from'../../internal/open-closed.js';import{match as X}from'../../utils/match.js';import{useResolveButtonType as Y}from'../../hooks/use-resolve-button-type.js';import{FocusableMode as Z,isFocusableElement as ee,sortByDomNode as te,Focus as B,focusFrom as ne,restoreFocusIfNecessary as U}from'../../utils/focus-management.js';import{useOutsideClick as ae}from'../../hooks/use-outside-click.js';import{useTrackedPointer as ue}from'../../hooks/use-tracked-pointer.js';var re=(u=>(u[u.Open=0]="Open",u[u.Closed=1]="Closed",u))(re||{}),ie=(u=>(u[u.Pointer=0]="Pointer",u[u.Other=1]="Other",u))(ie||{});function oe(a){requestAnimationFrame(()=>requestAnimationFrame(a))}let $=Symbol("MenuContext");function w(a){let r=Q($,null);if(r===null){let u=new Error(`<${a} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(u,w),u}return r}let De=D({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:r,attrs:u}){let s=R(1),e=R(null),I=R(null),c=R([]),g=R(""),f=R(null),d=R(1);function t(i=o=>o){let o=f.value!==null?c.value[f.value]:null,n=te(i(c.value.slice()),m=>v(m.dataRef.domRef)),l=o?n.indexOf(o):null;return l===-1&&(l=null),{items:n,activeItemIndex:l}}let S={menuState:s,buttonRef:e,itemsRef:I,items:c,searchQuery:g,activeItemIndex:f,activationTrigger:d,closeMenu:()=>{s.value=1,f.value=null},openMenu:()=>s.value=0,goToItem(i,o,n){let l=t(),m=W(i===b.Specific?{focus:b.Specific,id:o}:{focus:i},{resolveItems:()=>l.items,resolveActiveIndex:()=>l.activeItemIndex,resolveId:M=>M.id,resolveDisabled:M=>M.dataRef.disabled});g.value="",f.value=m,d.value=n!=null?n:1,c.value=l.items},search(i){let n=g.value!==""?0:1;g.value+=i.toLowerCase();let m=(f.value!==null?c.value.slice(f.value+n).concat(c.value.slice(0,f.value+n)):c.value).find(E=>E.dataRef.textValue.startsWith(g.value)&&!E.dataRef.disabled),M=m?c.value.indexOf(m):-1;M===-1||M===f.value||(f.value=M,d.value=1)},clearSearch(){g.value=""},registerItem(i,o){let n=t(l=>[...l,{id:i,dataRef:o}]);c.value=n.items,f.value=n.activeItemIndex,d.value=1},unregisterItem(i){let o=t(n=>{let l=n.findIndex(m=>m.id===i);return l!==-1&&n.splice(l,1),n});c.value=o.items,f.value=o.activeItemIndex,d.value=1}};return ae([e,I],(i,o)=>{var n;S.closeMenu(),ee(o,Z.Loose)||(i.preventDefault(),(n=v(e))==null||n.focus())},h(()=>s.value===0)),H($,S),z(h(()=>X(s.value,{[0]:O.Open,[1]:O.Closed}))),()=>{let i={open:s.value===0,close:S.closeMenu};return P({ourProps:{},theirProps:a,slot:i,slots:r,attrs:u,name:"Menu"})}}}),Pe=D({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:()=>`headlessui-menu-button-${C()}`}},setup(a,{attrs:r,slots:u,expose:s}){let e=w("MenuButton");s({el:e.buttonRef,$el:e.buttonRef});function I(d){switch(d.key){case p.Space:case p.Enter:case p.ArrowDown:d.preventDefault(),d.stopPropagation(),e.openMenu(),y(()=>{var t;(t=v(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(b.First)});break;case p.ArrowUp:d.preventDefault(),d.stopPropagation(),e.openMenu(),y(()=>{var t;(t=v(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(b.Last)});break}}function c(d){switch(d.key){case p.Space:d.preventDefault();break}}function g(d){a.disabled||(e.menuState.value===0?(e.closeMenu(),y(()=>{var t;return(t=v(e.buttonRef))==null?void 0:t.focus({preventScroll:!0})})):(d.preventDefault(),e.openMenu(),oe(()=>{var t;return(t=v(e.itemsRef))==null?void 0:t.focus({preventScroll:!0})})))}let f=Y(h(()=>({as:a.as,type:r.type})),e.buttonRef);return()=>{var n;let d={open:e.menuState.value===0},o=a,{id:t}=o,S=T(o,["id"]),i={ref:e.buttonRef,id:t,type:f.value,"aria-haspopup":"menu","aria-controls":(n=v(e.itemsRef))==null?void 0:n.id,"aria-expanded":a.disabled?void 0:e.menuState.value===0,onKeydown:I,onKeyup:c,onClick:g};return P({ourProps:i,theirProps:S,slot:d,attrs:r,slots:u,name:"MenuButton"})}}}),Oe=D({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-menu-items-${C()}`}},setup(a,{attrs:r,slots:u,expose:s}){let e=w("MenuItems"),I=R(null);s({el:e.itemsRef,$el:e.itemsRef}),J({container:h(()=>v(e.itemsRef)),enabled:h(()=>e.menuState.value===0),accept(t){return t.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:t.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(t){t.setAttribute("role","none")}});function c(t){var S;switch(I.value&&clearTimeout(I.value),t.key){case p.Space:if(e.searchQuery.value!=="")return t.preventDefault(),t.stopPropagation(),e.search(t.key);case p.Enter:if(t.preventDefault(),t.stopPropagation(),e.activeItemIndex.value!==null){let o=e.items.value[e.activeItemIndex.value];(S=v(o.dataRef.domRef))==null||S.click()}e.closeMenu(),U(v(e.buttonRef));break;case p.ArrowDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(b.Next);case p.ArrowUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(b.Previous);case p.Home:case p.PageUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(b.First);case p.End:case p.PageDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(b.Last);case p.Escape:t.preventDefault(),t.stopPropagation(),e.closeMenu(),y(()=>{var i;return(i=v(e.buttonRef))==null?void 0:i.focus({preventScroll:!0})});break;case p.Tab:t.preventDefault(),t.stopPropagation(),e.closeMenu(),y(()=>ne(v(e.buttonRef),t.shiftKey?B.Previous:B.Next));break;default:t.key.length===1&&(e.search(t.key),I.value=setTimeout(()=>e.clearSearch(),350));break}}function g(t){switch(t.key){case p.Space:t.preventDefault();break}}let f=G(),d=h(()=>f!==null?(f.value&O.Open)===O.Open:e.menuState.value===0);return()=>{var l,m;let t={open:e.menuState.value===0},n=a,{id:S}=n,i=T(n,["id"]),o={"aria-activedescendant":e.activeItemIndex.value===null||(l=e.items.value[e.activeItemIndex.value])==null?void 0:l.id,"aria-labelledby":(m=v(e.buttonRef))==null?void 0:m.id,id:S,onKeydown:c,onKeyup:g,role:"menu",tabIndex:0,ref:e.itemsRef};return P({ourProps:o,theirProps:i,slot:t,attrs:r,slots:u,features:j.RenderStrategy|j.Static,visible:d.value,name:"MenuItems"})}}}),we=D({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-menu-item-${C()}`}},setup(a,{slots:r,attrs:u,expose:s}){let e=w("MenuItem"),I=R(null);s({el:I,$el:I});let c=h(()=>e.activeItemIndex.value!==null?e.items.value[e.activeItemIndex.value].id===a.id:!1),g=h(()=>({disabled:a.disabled,textValue:"",domRef:I}));N(()=>{var l,m;let n=(m=(l=v(I))==null?void 0:l.textContent)==null?void 0:m.toLowerCase().trim();n!==void 0&&(g.value.textValue=n)}),N(()=>e.registerItem(a.id,g)),_(()=>e.unregisterItem(a.id)),q(()=>{e.menuState.value===0&&c.value&&e.activationTrigger.value!==0&&y(()=>{var n,l;return(l=(n=v(I))==null?void 0:n.scrollIntoView)==null?void 0:l.call(n,{block:"nearest"})})});function f(n){if(a.disabled)return n.preventDefault();e.closeMenu(),U(v(e.buttonRef))}function d(){if(a.disabled)return e.goToItem(b.Nothing);e.goToItem(b.Specific,a.id)}let t=ue();function S(n){t.update(n)}function i(n){t.wasMoved(n)&&(a.disabled||c.value||e.goToItem(b.Specific,a.id,0))}function o(n){t.wasMoved(n)&&(a.disabled||c.value&&e.goToItem(b.Nothing))}return()=>{let{disabled:n}=a,l={active:c.value,disabled:n,close:e.closeMenu},F=a,{id:m}=F,M=T(F,["id"]);return P({ourProps:{id:m,ref:I,role:"menuitem",tabIndex:n===!0?void 0:-1,"aria-disabled":n===!0?!0:void 0,disabled:void 0,onClick:f,onFocus:d,onPointerenter:S,onMouseenter:S,onPointermove:i,onMousemove:i,onPointerleave:o,onMouseleave:o},theirProps:k(k({},u),M),slot:l,attrs:u,slots:r,name:"MenuItem"})}}});export{De as Menu,Pe as MenuButton,we as MenuItem,Oe as MenuItems};
