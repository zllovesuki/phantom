var ve=Object.defineProperty,pe=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var $=(e,t,n)=>t in e?ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,o=(e,t)=>{for(var n in t||(t={}))q.call(t,n)&&$(e,n,t[n]);if(w)for(var n of w(t))G.call(t,n)&&$(e,n,t[n]);return e},x=(e,t)=>pe(e,me(t));var J=(e,t)=>{var n={};for(var r in e)q.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&w)for(var r of w(e))t.indexOf(r)<0&&G.call(e,r)&&(n[r]=e[r]);return n};import{computed as L,defineComponent as Q,h as W,inject as O,onMounted as b,onUnmounted as X,provide as R,ref as m,watch as Te,watchEffect as H,normalizeClass as ge}from"vue";import{useId as he}from'../../hooks/use-id.js';import{match as N}from'../../utils/match.js';import{env as ce}from'../../utils/env.js';import{Features as Se,omit as Ce,render as Y,RenderStrategy as T}from'../../utils/render.js';import{Reason as Z,transition as ee}from'./utils/transition.js';import{dom as te}from'../../utils/dom.js';import{useOpenClosedProvider as be,State as f,useOpenClosed as ye,hasOpenClosed as Ee}from'../../internal/open-closed.js';function g(e=""){return e.split(" ").filter(t=>t.trim().length>1)}let A=Symbol("TransitionContext");var Ve=(n=>(n.Visible="visible",n.Hidden="hidden",n))(Ve||{});function we(){return O(A,null)!==null}function xe(){let e=O(A,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}function Le(){let e=O(D,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}let D=Symbol("NestingContext");function F(e){return"children"in e?F(e.children):e.value.filter(({state:t})=>t==="visible").length>0}function ne(e){let t=m([]),n=m(!1);b(()=>n.value=!0),X(()=>n.value=!1);function r(a,i=T.Hidden){let s=t.value.findIndex(({id:d})=>d===a);s!==-1&&(N(i,{[T.Unmount](){t.value.splice(s,1)},[T.Hidden](){t.value[s].state="hidden"}}),!F(t)&&n.value&&(e==null||e()))}function h(a){let i=t.value.find(({id:s})=>s===a);return i?i.state!=="visible"&&(i.state="visible"):t.value.push({id:a,state:"visible"}),()=>r(a,T.Unmount)}return{children:t,register:h,unregister:r}}let re=Se.RenderStrategy,He=Q({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:n,slots:r,expose:h}){let a=m(0);function i(){a.value|=f.Opening,t("beforeEnter")}function s(){a.value&=~f.Opening,t("afterEnter")}function d(){a.value|=f.Closing,t("beforeLeave")}function C(){a.value&=~f.Closing,t("afterLeave")}if(!we()&&Ee())return()=>W(Be,x(o({},e),{onBeforeEnter:i,onAfterEnter:s,onBeforeLeave:d,onAfterLeave:C}),r);let v=m(null),l=m("visible"),ae=L(()=>e.unmount?T.Unmount:T.Hidden);h({el:v,$el:v});let{show:c,appear:I}=xe(),{register:P,unregister:B}=Le(),j={value:!0},S=he(),y={value:!1},M=ne(()=>{!y.value&&l.value!=="hidden"&&(l.value="hidden",B(S),C())});b(()=>{let u=P(S);X(u)}),H(()=>{if(ae.value===T.Hidden&&S){if(c&&l.value!=="visible"){l.value="visible";return}N(l.value,{["hidden"]:()=>B(S),["visible"]:()=>P(S)})}});let _=g(e.enter),U=g(e.enterFrom),ie=g(e.enterTo),K=g(e.entered),le=g(e.leave),se=g(e.leaveFrom),oe=g(e.leaveTo);b(()=>{H(()=>{if(l.value==="visible"){let u=te(v);if(u instanceof Comment&&u.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function ue(u){let E=j.value&&!I.value,p=te(v);!p||!(p instanceof HTMLElement)||E||(y.value=!0,c.value&&i(),c.value||d(),u(c.value?ee(p,_,U,ie,K,V=>{y.value=!1,V===Z.Finished&&s()}):ee(p,le,se,oe,K,V=>{y.value=!1,V===Z.Finished&&(F(M)||(l.value="hidden",B(S),C()))})))}return b(()=>{Te([c],(u,E,p)=>{ue(p),j.value=!1},{immediate:!0})}),R(D,M),be(L(()=>N(l.value,{["visible"]:f.Open,["hidden"]:f.Closed})|a.value)),()=>{let z=e,{appear:u,show:E,enter:p,enterFrom:V,enterTo:Oe,entered:Re,leave:Ne,leaveFrom:Ae,leaveTo:De}=z,k=J(z,["appear","show","enter","enterFrom","enterTo","entered","leave","leaveFrom","leaveTo"]),fe={ref:v},de=o(o({},k),I&&c&&ce.isServer?{class:ge([k.class,..._,...U])}:{});return Y({theirProps:de,ourProps:fe,slot:{},slots:r,attrs:n,features:re,visible:l.value==="visible",name:"TransitionChild"})}}}),Fe=He,Be=Q({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:n,slots:r}){let h=ye(),a=L(()=>e.show===null&&h!==null?(h.value&f.Open)===f.Open:e.show);H(()=>{if(![!0,!1].includes(a.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let i=m(a.value?"visible":"hidden"),s=ne(()=>{i.value="hidden"}),d=m(!0),C={show:a,appear:L(()=>e.appear||!d.value)};return b(()=>{H(()=>{d.value=!1,a.value?i.value="visible":F(s)||(i.value="hidden")})}),R(D,s),R(A,C),()=>{let v=Ce(e,["show","appear","unmount","onBeforeEnter","onBeforeLeave","onAfterEnter","onAfterLeave"]),l={unmount:e.unmount};return Y({ourProps:x(o({},l),{as:"template"}),theirProps:{},slot:{},slots:x(o({},r),{default:()=>[W(Fe,o(o(o({onBeforeEnter:()=>t("beforeEnter"),onAfterEnter:()=>t("afterEnter"),onBeforeLeave:()=>t("beforeLeave"),onAfterLeave:()=>t("afterLeave")},n),l),v),r.default)]}),attrs:{},features:re,visible:i.value==="visible",name:"Transition"})}}});export{He as TransitionChild,Be as TransitionRoot};
